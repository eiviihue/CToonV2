# Nixpacks configuration for Railway deployment with Tomcat 10
[phases.setup]
pkgs = ["jdk17", "maven"]
cmds = [
  "apt-get update && apt-get install -y curl",
  "mkdir -p /opt/tomcat",
  "curl -L -o /tmp/tomcat.tar.gz https://archive.apache.org/dist/tomcat/tomcat-10/v10.1.34/bin/apache-tomcat-10.1.34.tar.gz",
  "tar -xzf /tmp/tomcat.tar.gz -C /opt/tomcat --strip-components=1",
  "rm /tmp/tomcat.tar.gz"
]

[phases.build]
cmds = ["mvn clean package -DskipTests"]

[phases.start]
cmds = [
  "cp target/ctoon-1.0-SNAPSHOT.war /opt/tomcat/webapps/ROOT.war && /opt/tomcat/bin/catalina.sh run"
]

[variables]
JAVA_HOME = "/usr/lib/jvm/java-17-openjdk-amd64"
JAVA_VERSION = "17"
CATALINA_HOME = "/opt/tomcat"
